---
layout: post
title: V2ray + CDN 稳定看世界
ptype: outlook
mathjax: false
noindex: false
date: 2020-02-05 10:17:01
categories:
 - 分享集
tags:
 - V2ray
 - Socks
 - 扶梯
keywords: v2ray, ssr, ss, shadowsocks, 节点, 免费, cdn, cloudflare, 搭建, 教程
description: '最近墙一直「居高不下」，许多扶梯提供商已经坚持不住。但有些人还真是有访问外网需求，包括笔者自己。这里记录下一种（或许）能坚持更久的代理方式，尽可能维持大家的上网体验。顺便免费分享几个笔者自己搭建的节点，直到这段时期过去。'
purl: get-a-stable-outlook-through-v2ray-and-cdn
---

最近墙一直「居高不下」，许多扶梯提供商已经坚持不住。但有些人还真是有访问外网需求，包括笔者自己。这里记录下一种（或许）能坚持更久的代理方式，尽可能维持大家的上网体验。顺便免费分享几个笔者自己搭建的节点，直到这段时期过去。

<!--more-->

如果你想更深入地了解「代理」，可以看我之前写的一片文章「[Proxy Server | 正向代理与反向代理](/post/proxy-and-reverse-proxy/)」。这里就着重记录搭建方法。



## V2ray 简介

V2ray 是 Project V. 团队开发的内核，使用自实现的 Vmess 协议和 mKCP 协议，和 Shadowsocks 一样是一种新型代理方式。但是更进一步，V2ray 支持更多的协议，更多的混淆。也让这种代理（某种程度上）能活得更久。

但是我还是要来辟谣：并不是上了 V2ray 就真的能够骗过墙的眼睛，只不过能拖延一下而已，该做什么就做什么，不要整天想着怎么安全安全，规范自己的行为就好了。还有就是什么 *SS 已死* 的说法，稍微动动脑子好吗？就从我自己使用的经历来看，不论是机场还是自建主流都还是 Shadowsocks ，为什么？目前 V2ray 还是比较臃肿，占用大。我在同一台 VPS 上同是搭建了 SS 和V2ray，开启谷歌官方 BBR 拥堵控制算法，大陆南方联通／电信都有，晚上 11:30 ，SS 还能跑 50M，V2ray 只能跑 10M（全部是裸的跑）。而且 V2ray 的软件生态还是远不及 SS 的，客户端体验都不算良好。所以，不要见到 V2ray 就盲吹（当然也不能盲踩），就目前来讲，条件允许的话，我还是更愿意使用 SS。



## 搭建流程

一下操作可能需要一点动手能力，如果不愿折腾的同学可以考虑下 [IPLC 专线机场](/outlook/n3ro.html) ，由于专线**不过墙**特性，非常时期也可用！

### VPS 购买

首先无论是 SS／V2ray 都是与服务端通过 某种协议 建立隧道连接后通过服务端代理客户端的流量，从而实现上网目的。所以我们要先购买可用的境外服务器。

这里我不是很想推荐，大家按照自己习惯来。如果真的没有经验、或者不想淌主机圈这潭浑水的同学，可以尝试 [vultr](https://www.vultr.com) ，支持微信／支付宝付款，最低配置 5 刀／月，全球 16 个机房，直连推荐日本机房，大陆直连效果挺好，新加坡的机房就一般了，美西也不错。如果有能力注册阿里云国际并绑定支付方式的同学也可以尝试阿里云的机子，阿里新加坡的机房很好，直连大陆延迟都在两位数（70ms 左右），性价比也很高，不差钱也可以上香港的。

**但是！**由于这篇文章是介绍非常时期的连接，所以我们后面会使用 Cloudflare 提供的免费 CDN ，而应该没有人为了这个购买专业版，所以只有美国 CDN 节点，也建议购买 VPS 的时候选取美国机房，这样甚至比靠近的机房还快一点（回源远了嘛）。

然后就是如果你前往购买的云主机商家的官网并没有被墙的话请关闭代理登录，注册时候邮箱必须是真实有效的，地址可以不用真实的，但是请离你注册时使用的 IP 近一点，以免不必要的麻烦发生，其他信息自己看着办，别太离谱就好（vultr 只用一个邮箱就可以注册）。毕竟还是牵扯到钱的事情，小心为妙。

具体购买方法不想赘述，一般几个朋友日用选最低配置就够了，系统建议选择 CentOS/Debian/Ubuntu ，使用的人多、社区庞大，遇到问题也可以在各种教程、论坛中快速解决。



### 连接 VPS

假设到这里你已经成功拥有了一台了 VPS，主机商家应该回给你发送一个包含 IP 地址和 root 密码的邮件，你也可以登录它们的官网查看。我们要使用 SSH 工具连接 VPS。

Mac 使用自带终端即可，Windows 需要下载工具，如 [MobeXterm](https://mobaxterm.mobatek.net/) [Xshell](https://www.netsarang.com/zh/xshell/) 等工具。

笔者使用的是 Mac ，但操作大同小异。

1. 使用 SSH 远程连接 VPS

   ```
   ssh root@{ip_address} 
   ```

2. 然后将 root 密码复制到下面的密码框中并回车（不会显示）

3. 建议登录后先更改 root 密码，终端输入即可根据提示修改管理员密码：

   ```
   passwd
   ```



### 安装 V2ray

为了一定程度上更抗封锁，我们使用 ws (WebSocker) + tls + CDN 的形式，Cloudflare 提供免费的 CDN ，所以我们只需要提供服务器的费用、域名的费用（可选）和时间成本。

首先安装 V2ray：

```
bash <(curl -s -L https://git.io/v2ray.sh)
```

> 如果报错可能是你 VPS 系统没有安装 curl
>
> CentOS 安装：`yum update -y && yum install curl -y` 
>
> Debian/Ubuntu 安装：`apt-get update -y && apt-get install curl -y` 

然后根据提示来，传入协议选择 `WebSocket + TLS` ，端口不小于 `1025` 且没有被占用。

填写的域名记得解析到 VPS 的 IP 上，如果你还没有域名，可以考虑：

- 付费：[浅谈国外域名注册商](/post/49/) 
- 免费：[Freenom 免费域名申请及使用](/post/33/) 

域名其实不贵，如果要求不高再考虑免费域名，毕竟一个域名可以干许多事情，Namesilo 还提供终身的免费 WhoisGuard 隐私防护。获得域名后将域名托管给 Cloudflare 并打开 CDN 服务。[教程](/post/51/) 

填写好域名后不要自动配置 TLS ，我们后面自己来。至于去广告和安装 SS 自己看，反正我是没有选择，让专业的人做专业的事。

之后让它安装就好，记得最后记录一下配置文件的路径，后面会用到。



### 安装宝塔面板

宝塔面板是一个对新手十分友好的 VPS 运维可视化操作面板。

CentOS ：

```bash
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
```

Debian/Ubuntu :

```bash
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
```

安装好后登录（记得登录随后修改默认登录密码），安装 Nginx（如果日后还有建站需求也可以安装 LNMP 一绝后患）。

### 新建网站

配置好环境之后就可以新建一个网站。域名填写刚刚配置在 V2ray 的那个域名，由于默认 V2ray 使用 443 端口，所以需要 https ，可以使用 Let's Encrypt 或者 Clouflare 的免费 SSL 证书。

![](https://cdn.jsdelivr.net/gh/chralpha/imgbag/20200205234717.jpg)

这里重点介绍下 Cloudflare 的证书申请，前提是你将域名交给 Cloudflare 托管（不交给他你后面怎么它们的 CDN 呢）。

在域名管理页面 SSL/TLS -> Origin Server -> Create Certificate 创建证书，注意保存下来，密匙只会出现一次。

![](https://cdn.jsdelivr.net/gh/chralpha/imgbag/20200205135228.jpg)

然后从宝塔面板网站 SSL 设置中的其他证书中导入此证书即可。

接着修改配置文件，在合适的地方添加：

```nginx
location /test { # 准备设置的路径
    proxy_pass       http://127.0.0.1:12345; # V2ray 中设置的端口
    proxy_redirect             off;
    proxy_http_version         1.1;
    proxy_set_header Upgrade   $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host      $http_host;
}
```

![](https://cdn.jsdelivr.net/gh/chralpha/imgbag/20200205235440.jpg)

你甚至可以添加一个反向代理到正常的网站，让流量看起来更正常。

### 修改 V2ray 配置

在 V2ray 配置文件中（一般在 `/etc/v2ray/config.json `）定位到 `streamSettings` ，然后追加成类似下面的配置：

```nginx
"streamSettings": {
  "network": "ws",
  "wsSettings": {
    "path": "/test"
  }
}
```

注意在有多个设置时，除了最后一项，其他每一项都要在最后加一个英文半角逗号。

之后执行 `v2ray restart` 重启即可。

### 安装 BBR

BBR 是谷歌推出的一款拥堵控制算法，可以在基本不增加负载的情况下有效提升连接体验。

使用 `v2ray bbr` 即可安装 BBR 插件，不推荐其他魔改。

> 很多人看到BBR不排队的特征后，第一想到的就是 ***不排队甚好，但稍微在缓存队列里堆点数据包也不错，不然怎么能赢了那些不守规矩的流呢？*** 于是乎就出现了各类所谓的 ***BBR优化***，无一例外地都是把Reno/CUBIC那一套算法的 ***精髓*** 照搬到BBR，于是BBR就被玩坏了！
>
> …
>
> 我退出了 ***BBR优化队伍***，我也不玩了，我潜下心希望能 ***从数学上证明BBR不排队就是最优的，只要排队就不行，一点队列也不行***。本文写作前一天，我得了一些结论。记录这些结论并记录我是怎么想的，就是本文的主要内容。
>
> ---
>
> 具体前往：https://blog.csdn.net/dog250/article/details/82892267



## 客户端配置

服务端配置完成了，接下来看看客户端。目前有人整理了各平台可用的客户端 [链接地址](https://www.v2ray.com/awesome/tools.html) 。

可以在 VPS 中使用 `v2ray url` 或者 `v2ray qr` 显示节点的链接或者二维码。

> 但是导入的时候笔者遇到了一个问题，就是即便修改了 V2ray 配置文件并且重启后，路径仍为默认路经 `/` ，所以导入到客户端的时候需要手动修改为你设置的路径，就可以正常连接。



## 节点分享

真的有紧急需求却无从连接？这里提供博主自建和收集的几个免费节点供大家使用。**请不要在任何场合分享，仅供个人学习使用，请勿作出违反你所在地区及服务器所在地区法律法规的行为，请勿用来下载侵权内容等一切不道德行为。** 

不是不限流量的 VPS ，所以连不上可能是没流量了，套用了 CDN 。如果有需求还是建议上付费机场，有服务保障，有售后。

```
不定期更新 (最后更新时间 2020-2-22)：

V2ray

vmess://eyJhZGQiOiJuZW8yMDIwYS4xYW1ibG9nLmdhIiwiYWlkIjoiMjMzIiwiaG9zdCI6Im5lbzIwMjBhLjFhbWJsb2cuZ2EiLCJpZCI6IjIyZDQwMWMzLTBmNzktNGJjNS05NzA3LWExM2FkODFiMWVkNiIsIm5ldCI6IndzIiwicGF0aCI6Ii9zZWV0aGV3b3JsZCIsInBvcnQiOiI0NDMiLCJwcyI6IlVT576O5Zu95YWN6LS56IqC54K5IHwgQ2hyQWxwaGEuY29tIOaUr+aMgSIsInRscyI6InRscyIsInR5cGUiOiJub25lIiwidiI6IjIifQ==

vmess://eyJwcyI6IltmcmVlLXNzLnNpdGVdd3d3Lmtlcm5lbHMuYmlkIiwiYWRkIjoid3d3Lmtlcm5lbHMuYmlkIiwicG9ydCI6IjQ0MyIsImlkIjoiOTRhYWJkMTktNWNmZi01ODNjLTNkNmUtY2VkNDY0OTM4ZjVjIiwiYWlkIjoiMCIsIm5ldCI6IndzIiwidHlwZSI6Im5vbmUiLCJob3N0IjoiL3dzIiwidGxzIjoidGxzIn0=

(owocat.xyz 需代理访问) 
vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIue+juWbvWNob29wYXxvd29jYXQueHl6IiwNCiAgImFkZCI6ICJjZG4ydXMuMWxvbGkucHciLA0KICAicG9ydCI6ICI0NDMiLA0KICAiaWQiOiAiYjk3YmJmNzQtNGQ0NC0xMWVhLWEwN2MtNTYwMDAyOGI5MjdjIiwNCiAgImFpZCI6ICIzIiwNCiAgIm5ldCI6ICJ3cyIsDQogICJ0eXBlIjogIm5vbmUiLA0KICAiaG9zdCI6ICIiLA0KICAicGF0aCI6ICIvbGFNZDZxRVovIiwNCiAgInRscyI6ICJ0bHMiDQp9

vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIuS/hOe9l+aWr3xvd29jYXQueHl6IiwNCiAgImFkZCI6ICI0Ni4xNy40MS4xMiIsDQogICJwb3J0IjogIjEwMjM2IiwNCiAgImlkIjogImQ1ZTgxNDA2LTRmOTYtMTFlYS04MzdmLTk2Mzg2ZjZhM2UwNyIsDQogICJhaWQiOiAiMCIsDQogICJuZXQiOiAidGNwIiwNCiAgInR5cGUiOiAibm9uZSIsDQogICJob3N0IjogIiIsDQogICJwYXRoIjogIiIsDQogICJ0bHMiOiAiIg0KfQ==
vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIlYycmF55L+E572X5pav6IqC54K5I+abtOWkmuiKgueCueivt+WFs+azqOeUteaKpemikemBk0B2eml3bCIsDQogICJhZGQiOiAidjJyYXkucnUubXNrLnYycmF5bmIueHl6IiwNCiAgInBvcnQiOiAiNDQzIiwNCiAgImlkIjogIjc0Y2JiOTEzLWRlNDUtNDU1YS04NDY0LTFiYzE4ZjUyYmFmOSIsDQogICJhaWQiOiAiNjQiLA0KICAibmV0IjogIndzIiwNCiAgInR5cGUiOiAibm9uZSIsDQogICJob3N0IjogInYycmF5LnJ1Lm1zay52MnJheW5iLnh5eiIsDQogICJwYXRoIjogIi84ZDI4YzMwNC8iLA0KICAidGxzIjogInRscyINCn0=
vmess://eyJhZGQiOiJ2MnJheS51cy5sc2oudjJyYXluYi54eXoiLCJhaWQiOiI2NCIsImhvc3QiOiJ2MnJheS51cy5sc2oudjJyYXluYi54eXoiLCJpZCI6ImRmY2Y5OWQ3LWJjMTMtNDQ1MS05NjAwLThhNGFjNzJiNGQ2NiIsIm5ldCI6IndzIiwicGF0aCI6Ii9lNWExMjI1YS8iLCJwb3J0IjoiNDQzIiwicHMiOiJWMnJheee+juWbvU1D6IqC54K5I+abtOWkmuiKgueCueivt+WFs+azqOeUteaKpemikemBk0B2eml3bCIsInRscyI6InRscyIsInR5cGUiOiJub25lIiwidiI6IjIifQ==
vmess://eyJhZGQiOiJ2MnJheS1hd3MudjJyYXluYi54eXoiLCJhaWQiOiI2NCIsImhvc3QiOiJ2MnJheS1hd3MudjJyYXluYi54eXoiLCJpZCI6ImY4NGM5Y2Y0LTI2MzEtNDk3My1hMDllLTkzNTIyYzg3ZmE4MCIsIm5ldCI6IndzIiwicGF0aCI6Ii8xNTU0YjFkNi8iLCJwb3J0IjoiNDQzIiwicHMiOiJWMnJheee+juWbvUFXU+iKgueCuSPmm7TlpJroioLngrnor7flhbPms6jnlLXmiqXpopHpgZNAdnppd2wiLCJ0bHMiOiJ0bHMiLCJ0eXBlIjoibm9uZSIsInYiOiIyIn0=
vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIue+juWbveilv+mbheWbvnxvd29jYXQueHl6IiwNCiAgImFkZCI6ICIxOTIuMy44MC4xNTkiLA0KICAicG9ydCI6ICIxMDA5OCIsDQogICJpZCI6ICI2YmU5YmNlNC00Zjk2LTExZWEtOGI3Zi0wMDE2M2M4ZGM1MWUiLA0KICAiYWlkIjogIjAiLA0KICAibmV0IjogInRjcCIsDQogICJ0eXBlIjogIm5vbmUiLA0KICAiaG9zdCI6ICIiLA0KICAicGF0aCI6ICIiLA0KICAidGxzIjogIiINCn0=
vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIue+juWbvea0m+adieeftnxvd29jYXQueHl6IiwNCiAgImFkZCI6ICIxMDcuMTc0LjE3MC4xNjciLA0KICAicG9ydCI6ICIxMDI0NSIsDQogICJpZCI6ICJhMjU0OGY1MC00ZGY5LTExZWEtYTAwMy0wMDE2M2M4NzAzYmUiLA0KICAiYWlkIjogIjAiLA0KICAibmV0IjogInRjcCIsDQogICJ0eXBlIjogIm5vbmUiLA0KICAiaG9zdCI6ICIiLA0KICAicGF0aCI6ICIiLA0KICAidGxzIjogIiINCn0=
vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIue+juWbvWNob29wYXxvd29jYXQueHl6IiwNCiAgImFkZCI6ICJjZG4ydXMuMWxvbGkucHciLA0KICAicG9ydCI6ICI0NDMiLA0KICAiaWQiOiAiYjk3YmJmNzQtNGQ0NC0xMWVhLWEwN2MtNTYwMDAyOGI5MjdjIiwNCiAgImFpZCI6ICIzIiwNCiAgIm5ldCI6ICJ3cyIsDQogICJ0eXBlIjogIm5vbmUiLA0KICAiaG9zdCI6ICIiLA0KICAicGF0aCI6ICIvbGFNZDZxRVovIiwNCiAgInRscyI6ICJ0bHMiDQp9
vmess://eyJhZGQiOiJ2MnJheS1qcC5xb3ZvcS5jZiIsImFpZCI6IjY0IiwiaG9zdCI6InYycmF5LWpwLnFvdm9xLmNmIiwiaWQiOiI5ZDBjY2YzMi1hYTVjLTRlNmUtYTMxYi1iY2VhODcwMjkwMzEiLCJuZXQiOiJ3cyIsInBhdGgiOiIvYWFjMzUzYTUvIiwicG9ydCI6IjQ0MyIsInBzIjoiVjJyYXnml6XmnKxOVFToioLngrkj5pu05aSa6IqC54K56K+35YWz5rOo55S15oql6aKR6YGTQHZ6aXdsIiwidGxzIjoidGxzIiwidHlwZSI6Im5vbmUiLCJ2IjoiMiJ9

Shadowsocks: 封锁太快，停止分享
```









